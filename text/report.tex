\documentclass[a4paper,twocolumn]{jsarticle}
\usepackage[deluxe]{otf}
\usepackage[T1]{fontenc}
\usepackage{lmodern}
\usepackage[dvipdfm]{pict2e}
\def\pdfliteral#1{\special{pdf:content #1}}
\usepackage[dvipdfmx]{graphicx}
\usepackage{url}
\usepackage{amsmath,amssymb}
\usepackage{geometry}
\geometry{left=10mm,right=10mm,top=15mm,bottom=20mm}
\usepackage{listings,jlisting}
\lstset{language=C,%
        basicstyle=\scriptsize\usefont{T1}{pcr}{m}{n},%
        commentstyle=\usefont{T1}{pcr}{m}{it},%
        classoffset=1,%
	    frame=single,%
        framesep=5pt,%
	    showstringspaces=false,%
        numbers=left,%
        stepnumber=1,%
        numberstyle=\scriptsize%
}

\title{pythonで作る人狼ゲームAI(仮)}
\author{佐藤 翔悦}
\date{2014年8月15日}

\begin{document}
\setlength{\columnsep}{30pt}
\maketitle

\section{はじめに}
授業でpythonに触れたので以前から暇を見て書いてみようかな、と思っていた人狼ゲームのAIについてです。
ゲーム中に会話・推理・説得などの要素が含まれるので、将棋・囲碁のような最善手の探索をしていくタイプのAIとは違って

\begin{itemize}
\item プレイヤーの会話からなんとなく怪しい、といった印象及び論理の矛盾を発見する
\item ゲームが成立するように、会話を行う
\end{itemize}
といった機能が必要になってくるため、高度な自然言語処理的な技術が要求されます。現在このゲームについての研究はそう多くはなく、
CPU対戦が出来るようなアプリケーションでもプレイヤー・AIの会話は無く、盤面上の状況から確率的に判断するといったもののみです。

流石に今の段階ではまともなAIを作ることは時間的にも技術的にもちょっと厳しいので、
今回はゲーム全体の枠組みと・ネット上での対戦結果のログのパーサ・プレイヤーの発言からの簡単な役職当てシステムを作成しました。
ゲーム内での会話についてはあまりにも難易度が高いので色々勉強が必要そうです...。

ソースは\url{https://github.com/jack-and-rozz/werewolf.git} をgit cloneしてください。

\section{人狼ゲームについて}

\subsection{概要}
汝は人狼なりや？(Are you werewolf?)と呼ばれる、複数人で行う正体隠匿系パーティゲーム。1930年代頃からヨーロッパでプレイされていた。マフィア・ゲームとも。

色々と形式・ローカルルールがあるが、今回はインターネット上で一般的であり対戦ログの入手が容易な「汝は人狼なりや？続わかめてエディション」\cite{wakamete}の17人戦・狐・初日役職犠牲者あり形式を採用する。 詳しいルールは \verb+「汝は人狼なりや？」基本的なルール+ \cite{jinrourule}や\verb+Wikipedia - 汝は人狼なりや？+\cite{wikipedia-jinrou}参照。

\subsection{ルール}

各プレイヤーはゲーム開始時に自分とゲームマスターのみが知る役職が割り振られ、
その役職によって村人サイド・人狼サイド・妖狐サイドに分かれる。

ゲームは0日目の夜から始まり、夜と昼のフェーズを交互に繰り返して進んでいく。
昼のフェーズは生存しているプレイヤー全員で議論を行い、その日処刑するプレイヤーを投票で決定する。

夜のフェーズは生存している人狼が話しあって１人殺害するプレイヤーを決定する。役職持ちのプレイヤーは能力の使用対象を決定する。

これを繰り返し、人狼が全て死亡したら村人の勝利、「人間」の数が人狼の数と同数以下になれば人狼の勝利、
村人・人狼どちらかの勝利が確定した時点で妖狐が生存していれば妖狐の勝利となる。

\subsection{役職}
名前の横の数字は17人戦における人数。
\begin{itemize}
\item 村人(Villager)(7) : 村人サイド。なにも能力はない。
\item 占い師(Seer)(1)：村人サイド。一晩に一回、指定したプレイヤーが「人狼」であるかどうかを判定できる。
\item 霊能者(Medium)(1)：村人サイド。一晩に一回、昼に処刑したプレイヤーが「人狼」であるかどうかを判定できる。
\item 狩人(Hunter)(1)：村人サイド。一晩に一回、自分以外の指定したプレイヤーを護衛できる。護衛されたプレイヤーは人狼の能力によって殺害されない。
\item 共有者(Freemason)(2)：村人サイド。夜の間、共有者同士で会話が出来る。
\item 人狼(Wolf)(3) : 人狼サイド。一晩に一回、指定したプレイヤーを殺害できる。
\item 狂人(Lunatic)(1) : 人狼サイド。占い・霊能からは「人間」と判定される。最後の勝利条件にも「人間」としてカウントする。
\item 妖狐(Fox)(1) : 妖狐サイド。人狼の能力によって殺害されない。ただし、占い師によって占われた場合死亡する。占い・霊能からは「人間」と判定される。最後の勝利条件にも「人間」としてカウントする。
\end{itemize}

\subsection{用語}
\begin{itemize}
\item 人間 : 占い師・霊能者によって人間と判定される役職。村人サイドの全員 + 狂人 + 妖狐。
\item 吊り : 昼の投票による処刑。
\item 噛み : 夜の人狼による殺害。
\item ○(シロ) : 占い・霊能の判定結果が「人間」であったこと。 
\item ●(クロ) : 占い・霊能の判定結果が「人狼」であったこと。 
\end{itemize}

\section{Python-Mecab}
動かすためには形態素解析エンジン、python-mecabのインストールが必要。インストール方法は\verb+MeCabのインストール方法+ \cite{mecab-install}を参照。



\section{log\_manager}
werewolf/log\_managerディレクトリ内に本体がある。

\subsection{ログファイルのパース}
\begin{verbatim}
$ python log_manager -parse [srcfilename] 
[destfilename] 
\end{verbatim}
とすることで./log\_manager/logfiles内のソースファイルをパース可能。ただし今回はソースサイズが大きいので既にパース済みのファイルをgit管理下に置いてある。


\subsection{ログファイルからの学習}
\begin{verbatim}
$ python log_manager.py -learn 
\end{verbatim}
と実行すると./log\_manager/logfiles/parsed\_log を元に各形態素毎の役職のスコアが算出される。


\subsection{役職当てテスト}
\begin{verbatim}
$ python log_manager.py -infer [rolename] 
\end{verbatim}
で、./log\_manager/sampletexts/ 内にある各役職別の、学習に用いてない村4つ分程度の発言ログtext\_[rolename] を使った役職当てテストが行える。
rolename はそれぞれ villager | seer | medium | freemason | hunter | wolf | lunatic | fox の8つ。

\section{テスト実行結果・考察}
\begin{lstlisting}
********************************************
<villager> 結果 : 狩人
占い師  : 11.957 %
村人  : 12.786 %
狂人  : 11.900 %
霊能者  : 12.365 %
人狼  : 12.631 %
共有者  : 12.777 %
妖狐  : 12.779 %
狩人  : 12.804 %
********************************************
<wolf> 結果 : 人狼
占い師  : 13.015 %
村人  : 12.480 %
狂人  : 12.706 %
霊能者  : 12.198 %
人狼  : 13.022 %
共有者  : 11.979 %
妖狐  : 12.282 %
狩人  : 12.318 %
********************************************
<seer> 結果 : 占い師
占い師  : 13.500 %
村人  : 12.049 %
狂人  : 12.585 %
霊能者  : 12.666 %
人狼  : 12.653 %
共有者  : 11.991 %
妖狐  : 12.188 %
狩人  : 12.369 %
********************************************
<medium> 結果 : 狂人
占い師  : 12.284 %
村人  : 12.531 %
狂人  : 12.631 %
霊能者  : 12.563 %
人狼  : 12.444 %
共有者  : 12.565 %
妖狐  : 12.598 %
狩人  : 12.383 %
********************************************
<lunatic> 結果 : 狂人
占い師  : 12.144 %
村人  : 12.500 %
狂人  : 12.799 %
霊能者  : 12.641 %
人狼  : 12.480 %
共有者  : 12.513 %
妖狐  : 12.601 %
狩人  : 12.321 %
********************************************
<hunter> 結果 : 狩人
占い師  : 12.422 %
村人  : 12.499 %
狂人  : 12.558 %
霊能者  : 12.586 %
人狼  : 12.567 %
共有者  : 12.165 %
妖狐  : 12.524 %
狩人  : 12.680 %
********************************************
<freemason> 結果 : 霊能者
占い師  : 12.199 %
村人  : 12.481 %
狂人  : 12.382 %
霊能者  : 12.860 %
人狼  : 12.348 %
共有者  : 12.702 %
妖狐  : 12.661 %
狩人  : 12.368 %
********************************************
<fox> 結果 : 霊能者
占い師  : 12.371 %
村人  : 12.349 %
狂人  : 12.479 %
霊能者  : 12.765 %
人狼  : 12.410 %
共有者  : 12.686 %
妖狐  : 12.500 %
狩人  : 12.440 %

\end{lstlisting}


今のところ判定のアルゴリズムには発言を形態素ごとに分割し、学習から得たスコアを単に線形に足し合わせる、という方法を取っているため、
もう少し複雑にしなければゲーム上重要な用語（CO・噛み・吊り）といった情報が雑談に埋もれてしまってまともに判定できないのでは...という予想があったが、
結果を見ると人狼・占い師・狩人・狂人については判定に成功し、別の結果が出ている役職についても、例えば村人は、なるべく正体を隠し村人のように振る舞おうとする役職である狩人と判定される
など、それなりに納得できる結果になっている。

ただしこれは村４つ分の最初から最後までのデータを元にした結果で、各役職の差も1\%以下の違いしか無い。
実際のゲームでさらに少ない発言からリアルタイムな判断を行うには、単なるスコアリングではなく文章から論理構造を解析するような手法が必要になるだろう。
(そもそも人間どうしのゲームですら発言・行動の矛盾点からの推理が主であり、発言の雰囲気からの推定はそうできるものではない)

\begin{thebibliography}{9}
\bibitem{wakamete}
汝は人狼なりや？続わかめてエディション
\url{http://jinrou.dip.jp/~jinrou/}
\bibitem{jinrourule}
「汝は人狼なりや？」基本的なルール
\url{http://note.chiebukuro.yahoo.co.jp/detail/n118123}
\bibitem{wikipedia-jinrou}
Wikipedia - 汝は人狼なりや？
\url{http://ja.wikipedia.org/wiki/%E6%B1%9D%E3%81%AF%E4%BA%BA%E7%8B%BC%E3%81%AA%E3%82%8A%E3%82%84%3F}

\bibitem{mecab-install}
MeCabのインストール方法
\url{http://tatsuyaoiw.hatenablog.com/entry/20120414/1334397985}

\bibitem{jinrou-protocol}
人狼知能プロトコル
\url{http://www.aiwolf.org/%E4%BA%BA%E7%8B%BC%E7%9F%A5%E8%83%BD%E3%83%97%E3%83%AD%E3%83%88%E3%82%B3%E3%83%AB/}
\end{thebibliography}

\end{document}
